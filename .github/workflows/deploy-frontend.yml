name: üöÄ Deploy Frontend to S3

on:
  push:
    paths:
      - 'frontend/index.html'
    branches: [master] # –∞–±–æ —ñ–Ω—à–∞ —Ç–≤–æ—è –≥—ñ–ª–∫–∞

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v3

      - name: üß∞ Install AWS CLI via pip
        run: |
          sudo apt update
          sudo apt install -y python3-pip
          pip install awscli --upgrade --user
          echo "$HOME/.local/bin" >> $GITHUB_PATH

      - name: üì§ Upload index.html to S3
        run: |
          aws s3 cp frontend/index.html s3://f1-store-frontend-v1/index.html \
            --region ${{ secrets.AWS_REGION }}
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}


      - name: ‚ôªÔ∏è Invalidate CloudFront cache
        run: |
          aws cloudfront create-invalidation \
            --distribution-id ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }} \
            --paths "/index.html"
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
